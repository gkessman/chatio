<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>ChatIO</title>
	<style>
		* { margin: 0; padding: 0; box-sizing: border-box; }
		body { font: 13px Helvetica, Arial; }
		form { background: #000; padding: 3px; position: fixed; bottom: 0; width: 100%; }
		form input { border: 0; padding: 10px; width: 90%; margin-right: .5%; }
		form button { width: 9%; background: rgb(130, 224, 255); border: none; padding: 10px; }
		#messages { list-style-type: none; margin: 0; padding: 0; }
		#messages li { padding: 5px 10px; }
		#messages li:nth-child(odd) { background: #eee; }
		.banner { text-indent: 15px; font-family: "Lucida Console", Monaco, monospace; font-size: 32px; background-color: #676767; color: white }
		.event { color: orange; font-size: 12px; font-weight: bold; text-indent: 15px; }
		.time { float: right; font-size: 10px; }
		.date { color: #5A86BF; text-align: center; font-weight: bold; opacity: .5; }
		.name { float: left; padding-right: 20px; color: #30AFD8; font-weight: bold; }
		.user { display: inline; font-size: 15px; margin-left: -10px; }
		.banner-title { display: inline; padding-right: 20px }
		.online { display: inline-block; border: 6px solid #00BF00; border-radius: 50px; height: 10px; position: relative; top: 1px; }

	</style>
</head>
<body>
	<div class="banner">
		<p class="banner-title">ChatIO</p>
		<div class="online"></div>
		<p class="user"></p>
	</div>
	<hr />
	<ul id="messages"></ul>
	<form action="">
		<input type="text" id="m" autocomplete="off" /><button>Send</button>
		<script src="http://code.jquery.com/jquery-1.11.1.js"></script>
	</form>
	<script src="/socket.io/socket.io.js"></script>
	<script>
		var socket = io();
		var dateBanner = "";
		var name = "";

		$('form').submit(function(){
			var msg = {
				user: name,
				body: $('#m').val()
			};
			socket.emit('chat message', msg);
			$('#m').val('');
			return false;
		});

		socket.on('chat message', function(msg){
			checkDate();
			$('#messages').append($('<li>').text(msg.body));
			$('#messages li:last').prepend($('<p class="name">').text(msg.user));
			$('#messages li:last').append($('<p class="time">').text(new Date(msg.time).toLocaleTimeString()));
		});

		socket.on('event message', function(event){
			checkDate();
			$('#messages').append($('<li class="event">').text(event.user + ' ' + event.action));
			$('#messages li:last').append($('<p class="time">').text(new Date().toLocaleTimeString()));
			if (!name) {
				name = event.user;
				$('.user').text(name);
			}
		});

		var checkDate = function() {
			var d = new Date();
			var date = d.getMonth() + '/' + d.getDate() + '/' + d.getFullYear();
			if (dateBanner != date) {
				dateBanner = date;
				$('#messages').append($('<li class="date">').text(dateBanner));
			}
		}
	</script>
</body>
</html>